/* === NUTRIMARVIN â€“ MOTOR DE INTERPRETACIÃ“N FUNCIONAL ===
   Este bloque calcula el patrÃ³n predominante a partir de las respuestas.
   No modifica el HTML todavÃ­a. Solo define funciones listas para usar.
   ------------------------------------------------------------------- */

// Espera un arreglo "respuestas" con 15 elementos (Ã³ los que uses),
// en el mismo orden en que presentas las preguntas.
// Cada elemento debe tener un nÃºmero 1..5 en la propiedad "valor".
// Ejemplo: [{valor:3},{valor:5},...]
function interpretarPatron(respuestas) {
  if (!Array.isArray(respuestas) || respuestas.length === 0) {
    console.warn("interpretarPatron: respuestas invÃ¡lidas");
    return {
      patron: "PatrÃ³n no determinado",
      descripcion: "No pudimos interpretar tus respuestas. Intenta completar el diagnÃ³stico nuevamente.",
      recomendaciones: []
    };
  }

  // Suma por bloques (ajusta los cortes si cambiaste el nÃºmero de preguntas)
  // SuposiciÃ³n: 1â€“5 MetabÃ³lico, 6â€“10 Digestivo, 11â€“15 EstrÃ©s/SueÃ±o
  let scoreMetabolico = 0;
  let scoreDigestivo = 0;
  let scoreEstres = 0;

  respuestas.forEach((r, i) => {
    const v = Number(r?.valor) || 0;
    if (i < 5) scoreMetabolico += v;        // preguntas 0â€“4
    else if (i < 10) scoreDigestivo += v;   // preguntas 5â€“9
    else scoreEstres += v;                  // preguntas 10â€“14
  });

  const maxScore = Math.max(scoreMetabolico, scoreDigestivo, scoreEstres);

  // ConstrucciÃ³n del resultado
  let patron, descripcion, recomendaciones;

  if (maxScore === scoreMetabolico) {
    patron = "ðŸ©¸ PatrÃ³n MetabÃ³lico";
    descripcion =
      "Tu cuerpo muestra seÃ±ales de energÃ­a irregular o picos de glucosa. Este patrÃ³n se asocia con cansancio postcomida, antojos o dificultad para mantener el peso.";
    recomendaciones = [
      "Desayuna con proteÃ­na y fibra para evitar picos de azÃºcar.",
      "Evita comer con prisa o en estrÃ©s (respira antes de empezar).",
      "Camina 10 minutos despuÃ©s de las comidas para mejorar la sensibilidad a la insulina."
    ];
  } else if (maxScore === scoreDigestivo) {
    patron = "ðŸ’© PatrÃ³n Digestivo";
    descripcion =
      "Tu cuerpo muestra seÃ±ales de digestiÃ³n lenta o eliminaciÃ³n irregular. Este patrÃ³n suele reflejar sobrecarga intestinal o dificultad para eliminar toxinas.";
    recomendaciones = [
      "Agua tibia al despertar y vegetales en 2 de tus comidas.",
      "Mastica conscientemente; evita comer de pie o con pantallas.",
      "Incluye amargos suaves (rÃºcula, diente de leÃ³n) o tÃ© digestivo."
    ];
  } else {
    patron = "ðŸŒ™ PatrÃ³n de EstrÃ©s y SueÃ±o";
    descripcion =
      "Tu cuerpo muestra seÃ±ales de estrÃ©s sostenido o descanso superficial. Este patrÃ³n impacta la regulaciÃ³n hormonal y la glucosa.";
    recomendaciones = [
      "Evita pantallas 60 minutos antes de dormir.",
      "3 pausas de respiraciÃ³n (2 min) al dÃ­a para bajar el eje HPA.",
      "Incluye fuentes de magnesio o alimentos ricos en triptÃ³fano por la tarde."
    ];
  }

  return { patron, descripcion, recomendaciones, scoreMetabolico, scoreDigestivo, scoreEstres };
}

/* Exponemos una funciÃ³n para que el flujo la pueda llamar luego
   (en el siguiente paso conectaremos esta salida con el HTML). */
window.NutriMarvinResultados = {
  interpretarPatron
};